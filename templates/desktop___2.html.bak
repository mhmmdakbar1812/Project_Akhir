<!-- 
/*
 *	This content is generated from the PSD File Info.
 *	(Alt+Shift+Ctrl+I).
 *
 *	@desc 		
 *	@file 		desktop___2
 *	@date 		Sunday 14th of May 2023 06:16:40 AM
 *	@title 		Page 1
 *	@author 	
 *	@keywords 	
 *	@generator 	Export Kit v1.3.figma
 *
*/
 -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
	<head>
		<meta http-equiv="content-type" content="text/html" charset="utf-8" />
		<title>desktop___2</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="" >
		<link rel="stylesheet" href="{{ url_for('static', filename='css/desktop___2.css') }}" type="text/css">
		<script src="https://secure.exportkit.com/cdn/js/ek_googlefonts.js?v=6"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='webcamjs/webcam.min.js') }}"></script>
		<!-- Add your custom HEAD content here -->

	</head>
	<body>
		<div id="content-container" >
			<div id="_bg__desktop___2"  ></div>
			<div id="rectangle_3"  ></div>
			<div id="ticket_printing" >
				Deteksi Lelah
			</div>
			<a id="_ticket_printing_ek1_link" href="{{ url_for('capture_image') }}" >
			<div id="_ticket_printing_ek1" >
				Deteksi Lelah
			</div>
			</a>
			<a id="_home_link" href="/" >
			<div id="_home" >
				Home
			</div>
			</a>
			<div id="kelompok" >
				Kelompok
			</div>
			<div id="contact" >
				Contact
			</div>
			<div id="my_camera"  ></div>
			<!-- Configure a few settings and attach camera -->
			<script language="JavaScript">
			 Webcam.set({
				 width: 480,
				 height: 366,
				 image_format: 'jpeg',
				 jpeg_quality: 90
			 });
			 Webcam.attach( '#my_camera' );
			 </script>
			<form id="image-form" action="{{ url_for('capture_image') }}" method="post">
			  <a id="_rectangle_5_link" href="#" onclick="submitForm(); return false;">
				<div id="_rectangle_5"></div>
			  </a>
			  <a id="_capture_link" href="#" onclick="takeSnapshot(); return false;">
				<div id="_capture">Capture</div>
			  </a>
			  <input type="hidden" name="imageData" id="image-data">
			</form>
			<script language="JavaScript">
			// Fungsi untuk mengambil gambar dari webcam dan mengirimkannya ke server
			function takeSnapshot() {
			  Webcam.snap(function(data_uri) {
				var image_base64 = data_uri.split(',')[1]
				downloadImage('capture', data_uri); // Mengunduh gambar dengan nama 'capture.jpeg'
				
				// Mengirimkan gambar ke server menggunakan permintaan AJAX
				var formData = new FormData();
				formData.append('capture', dataURItoBlob(data_uri), 'capture.jpeg');
				var xhr = new XMLHttpRequest();
				xhr.open("POST", "/process_download", true);

				// Menghandle respons dari server
				xhr.onload = function() {
				  if (xhr.status === 200) {
					// Redirect ke halaman hasil prediks
					var prediction = xhr.responseText;
					localStorage.setItem("prediction", prediction);
					window.location.href = "{{ url_for('show_result') }}";
				  } else {
					// Menampilkan pesan error jika terjadi kesalahan
					console.error("Error:", xhr.responseText);
				  }
				};
				xhr.send(formData);
			  //window.location.href = "{{ url_for('show_result') }}";
			  });
			}

			function downloadImage(name, datauri) {
			  var a = document.createElement('a');
			  a.setAttribute('download', name);
			  a.setAttribute('href', datauri);
			  a.click();
			}

			// Mengubah data URI menjadi objek Blob
			function dataURItoBlob(dataURI) {
			  var byteString = atob(dataURI.split(',')[1]);
			  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
			  var ab = new ArrayBuffer(byteString.length);
			  var ia = new Uint8Array(ab);
			  for (var i = 0; i < byteString.length; i++) {
				ia[i] = byteString.charCodeAt(i);
			  }
			  return new Blob([ab], { type: mimeString });
			}
			
			function getLabel(prediction) {
			  var threshold = 0.5; // Nilai threshold yang Anda tentukan

			  if (prediction >= threshold) {
				return "open eye";
			  } else {
				return "closed eye";
			  }
			}

			// Contoh penggunaan
			/*
			function takeSnapshot() {
			  Webcam.snap(function(data_uri) {
				localStorage.setItem("imageData", data_uri);
				window.location.href = "{{ url_for('show_result') }}";
				var image_base64 = data_uri.split(',')[1];

				// Mengirimkan gambar ke server menggunakan permintaan AJAX
				var xhr = new XMLHttpRequest();
				xhr.open("POST", "/process_image", true);
				xhr.setRequestHeader("Content-Type", "application/json");

				// Mengirimkan data gambar dalam format base64 ke server
				var imageData = data_uri.split(",")[1];
				xhr.send(JSON.stringify({ imageData: imageData }));

				// Menghandle respons dari server
				xhr.onload = function() {
				  if (xhr.status === 200) {
					// Redirect ke halaman hasil prediksi
					window.location.href = "/show_result";
				  } else {
					// Menampilkan pesan error jika terjadi kesalahan
					console.error("Error:", xhr.responseText);
				  }
				};
			  });
			}
			*/
				// Code to handle taking the snapshot and redirecting to desktop___3.html
				//function takeSnapshot() {
					//Webcam.snap(function(data_uri) {
						//var imageDataInput = document.getElementById('image-data');
						//imageDataInput.value = data_uri;
						//document.getElementById('image-form').submit();
				//function takeSnapshot() {
					//Webcam.snap(function(data_uri) {
						//localStorage.setItem("imageData", data_uri);
						//window.location.href = "{{ url_for('show_result') }}";
			</script>
			</a>

		</div>
	</body>
</html>